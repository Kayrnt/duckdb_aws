# name: test/sql/aws_env_var.test
# description: test aws extension with the s3 env vars set
# group: [aws]

require aws

require httpfs

require-env AWS_ACCESS_KEY_ID

require-env AWS_SECRET_ACCESS_KEY

query I
CALL load_aws_credentials();
----
minio_duckdb_user

query I
select value from duckdb_settings() where name='s3_secret_access_key';
----
minio_duckdb_user_password

query I
select value from duckdb_settings() where name='s3_access_key_id';
----
minio_duckdb_user

# Trying to access a profile that doesn't exist should return NULL and not change anything
query I
CALL load_aws_credentials('profile-doesnt-exists-altogether');
----
NULL

# Same for passing null as a profile, it does nothing.
query I
CALL load_aws_credentials(NULL);
----
NULL

# Key is untouched
query I
select value from duckdb_settings() where name='s3_access_key_id';
----
minio_duckdb_user